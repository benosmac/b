---
import Layout from '../layouts/LayoutHome.astro'
import Button from '@components/Button.astro'
import { Icon } from 'astro-icon'
import ProjectCard from '@components/ProjectCard.astro'
import type { CollectionEntry } from 'astro:content'
import { getCollection } from 'astro:content'
import { ImportImage } from 'src/lib/importImages'
import ArticleCard from '@components/ArticleCard.astro'

const featuredProjects: Array<CollectionEntry<'projects'>> =
    await getCollection('projects', ({ data }) => {
        return data.isFeatured === true
    })
const sortedProjects = featuredProjects.sort((a, b) => {
    const aPriority = a.data.priority
    const bPriority = b.data.priority
    if (aPriority > bPriority) {
        return 1
    }
    if (aPriority < bPriority) {
        return -1
    }
    return 0
})
const articles: Array<CollectionEntry<'articles'>> = await getCollection(
    'articles'
)
---

<Layout title="Bengamin Osborn-Macpherson - Design & Development">
    <section class="intro">
        <h2>
            <span>Designer & frontend developer from Melbourne, Australia</span>
        </h2>
        <!-- <span>
            <Button
                text="Read things about me "
                url="#about"
                hasIcon={true}
                iconPosition="right"
                size="borderless"
            >
                <Icon name="mdi:arrow-down" slot="icon" />
            </Button>
        </span> -->
    </section>

    <section class="section projects">
        <div class="section-header">
            <h3>Projects</h3>
            <Button
                text="View all"
                url="/projects"
                hasIcon={true}
                iconPosition="right"
                size="borderless"
            >
                <Icon name="mdi:arrow-right" slot="icon" aria-hidden="true" />
            </Button>
        </div>
        <ul role="list" class="project-card-grid">
            {
                sortedProjects.map(async (project) => {
                    const img = await ImportImage(project.slug, 'feature')

                    return (
                        <ProjectCard
                            href={'/projects/' + project.slug}
                            title={project.data.title}
                            img={img}
                            loading="eager"
                            customColour={project.data.customColour}
                            categories={project.data.categories}
                        />
                    )
                })
            }
        </ul>
    </section>
    <section class="section articles">
        <div class="section-header">
            <h3>Articles</h3>
            <Button
                text="View all"
                url="/articles"
                hasIcon={true}
                iconPosition="right"
                size="borderless"
            >
                <Icon name="mdi:arrow-right" slot="icon" aria-hidden="true" />
            </Button>
        </div>
        <ul role="list" class="article-card-grid">
            {
                articles.map(async (article) => {
                    const img = await ImportImage(
                        'articles',
                        article.data.image
                    )
                    return (
                        <ArticleCard
                            href={'/articles/' + article.slug}
                            title={article.data.title}
                            img={img}
                            tags={article.data.tags}
                            date={article.data.date}
                            description={article.data.description}
                        />
                    )
                })
            }
        </ul>
    </section>
</Layout>

<style>
    .intro {
        position: relative;
        grid-column: 1 / span 6;
        padding: calc(var(--gapSize) * 2) var(--gapSize);
        & h2 {
            font-weight: 200;
            font-size: calc(var(--headingMultiplier) * 1.5);
            margin-bottom: calc(var(--gapSize) / 4);
            text-wrap: balance;
            max-width: 24ch;
        }
        & span {
            display: inline-block;
        }
        & :global(.button) {
            padding-left: 0;
            font-weight: 200;
        }
    }
    .section {
        display: flex;
        flex-direction: column;
        grid-column: 1 / span 6;
        padding: 0 var(--gapSize) var(--gapSize) var(--gapSize);
    }
    .projects {
        @media (min-width: 777px) {
            grid-column: 1 / span 3;
        }
        @media (min-width: 999px) {
            grid-column: 1 / span 4;
        }
    }
    .articles {
        @media (min-width: 777px) {
            grid-column: 4 / span 3;
        }
        @media (min-width: 999px) {
            grid-column: 5 / span 2;
        }
    }
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: var(--border);
        margin-bottom: var(--gapSize);
        padding-bottom: calc(var(--gapSize) / 2);
        & h3 {
            font-weight: var(--bodyWeight);
            margin: 0;
        }
    }
    .article-card-grid {
        position: relative;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        column-gap: var(--gapSize);
        row-gap: var(--gapSize);
        padding: 0;
        margin-bottom: var(--gapSize);
        margin-top: 0;
    }
    .project-card-grid {
        position: relative;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        column-gap: var(--gapSize);
        row-gap: var(--gapSize);
        padding: 0;
        margin-bottom: var(--gapSize);
        margin-top: 0;
        /* @media (min-width: 1000px) {
            grid-template-columns: repeat(3, minmax(300px, 1fr));
        } */
        @media (min-width: 777px) {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
    }
</style>
